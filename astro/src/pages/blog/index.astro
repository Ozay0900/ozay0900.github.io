---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

const allPosts = await getCollection('blog');
const sortedPosts = allPosts.sort((a, b) =>
    b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<Layout title="Blog">
    <main>
        <h1>My Blog</h1>

        <ul class="posts-list">
            {sortedPosts.map((post) => (
                    <li class="post-card">
                        {post.data.image && (
                                <img
                                        src={post.data.image}
                                        alt={post.data.title}
                                        class="post-image"
                                />
                        )}

                        <div class="post-content">
                            <h2 class="post-title">
                                <a href={`/blog/${post.slug}`}>{post.data.title}</a>
                            </h2>

                            <div class="post-meta">
                                <time>{new Date(post.data.pubDate).toLocaleDateString('en-US', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                })}</time>
                                {post.data.author && <span> â€¢ By {post.data.author}</span>}
                            </div>

                            <p class="post-description">{post.data.description}</p>
                        </div>
                    </li>
            ))}
        </ul>
    </main>

    <style>
        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            font-family: system-ui, sans-serif;
            line-height: 1.6;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 40px;
        }

        .posts-list {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .post-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 1px solid #eee;
            text-align: center;
            max-width: 700px;
            width: 100%;
        }

        .post-card:last-child {
            border-bottom: none;
        }

        .post-image {
            flex-shrink: 0;
            width: 200px;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }

        .post-content {
            flex: 1;
        }

        .post-title {
            margin: 0 0 10px 0;
            font-size: 1.8rem;
        }

        .post-title a {
            text-decoration: none;
            color: #0066cc;
        }

        .post-title a:hover {
            text-decoration: underline;
        }

        .post-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .post-description {
            color: #555;
            margin: 10px 0 0 0;
        }

        .read-more {
            display: inline-block;
            margin-top: 10px;
            color: #0066cc;
            text-decoration: none;
            font-weight: 500;
        }

        .read-more:hover {
            text-decoration: underline;
        }
    </style>
</Layout>